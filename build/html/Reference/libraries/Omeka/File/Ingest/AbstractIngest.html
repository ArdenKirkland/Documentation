

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Omeka_File_Ingest_AbstractIngest &mdash; Omeka Documentation v2.0 documentation</title>
    <link rel="stylesheet" href="../../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    
    <link rel="top" title="Omeka Documentation v2.0 documentation" href="../../../../../index.html" />
    <link rel="up" title="Libraries/Omeka/File/Ingest" href="index.html" />
    <link rel="next" title="Omeka_File_Ingest_AbstractSourceIngest" href="AbstractSourceIngest.html" />
    <link rel="prev" title="Libraries/Omeka/File/Ingest" href="index.html" />
    <link rel="stylesheet" href="../../../../../_static/overrides.css" type="text/css" />
 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="AbstractSourceIngest.html" title="Omeka_File_Ingest_AbstractSourceIngest"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Libraries/Omeka/File/Ingest"
             accesskey="P">previous</a> |</li>
    
        <li><a href="../../../../../index.html">Omeka Documentation v2.0 documentation</a> &raquo;</li>
    <p style="background-color: white; color:red;">
    This documentation is currently unstable as changes continue to be made to Omeka 2.0.    
     The final release of Omeka 2.0 may have changes.</p>    

          <li><a href="../../../../index.html" >Reference Documentation for Omeka</a> &raquo;</li>
          <li><a href="../../index.html" >Libraries/Omeka</a> &raquo;</li>
          <li><a href="../index.html" >Libraries/Omeka/File</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Libraries/Omeka/File/Ingest</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="omeka-file-ingest-abstractingest">
<h1>Omeka_File_Ingest_AbstractIngest<a class="headerlink" href="#omeka-file-ingest-abstractingest" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Omeka_File_Ingest_AbstractIngest">
<em class="property">class </em><tt class="descname">Omeka_File_Ingest_AbstractIngest</tt><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract class that handles ingesting files into Omeka and database.</p>
<p>Specific responsibilities handled by this class:
- Parsing/validating arbitrary inputs that somehow identify the files to be ingested.
- Iterating through the parsed file information, validating, and transferring each file to Omeka.
- Inserting a new record into the files table that corresponds to the transferred file&#8217;s metadata.
- Returning a collection of the records associated with the ingested files.</p>
<p>Typical usage is via the factory() method:</p>
<blockquote>
<div><div class="highlight-php"><div class="highlight"><pre><span class="nv">$ingest</span> <span class="o">=</span> <span class="nx">Omeka_File_Ingest_AbstractIngest</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s1">&#39;Url&#39;</span><span class="p">,</span> <span class="nv">$item</span><span class="p">);</span>
<span class="nv">$fileRecords</span> <span class="o">=</span> <span class="nv">$ingest</span><span class="o">-&gt;</span><span class="na">ingest</span><span class="p">(</span><span class="s1">&#39;http://www.example.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<dl class="attr">
<dt id="Omeka_File_Ingest_AbstractIngest::$_item">
<em class="property">property </em><tt class="descname">_item</tt><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::$_item" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attr">
<dt id="Omeka_File_Ingest_AbstractIngest::$_options">
<em class="property">property </em><tt class="descname">_options</tt><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::$_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of arbitrary options to use when ingesting files.</p>
</dd></dl>

<dl class="attr">
<dt id="Omeka_File_Ingest_AbstractIngest::$_validators">
<em class="property">property </em><tt class="descname">_validators</tt><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::$_validators" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of validators implementing Zend_Validate_Interface.</p>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::setItem">
<tt class="descname">setItem</tt><big>(</big><em>Item $item</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::setItem" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the item to use as a target when ingesting files.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$item</strong> (<a class="reference internal" href="../../../../models/Item.html#Item" title="Item"><em>Item</em></a>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">void</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::factory">
<tt class="descname">factory</tt><big>(</big><em>string $adapterName</em>, <em>Item $item</em>, <em>array $options = Array</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Factory to retrieve Omeka_File_Ingest_* instances.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$adapterName</strong> (<em>string</em>) &#8211; Ingest adapter.</li>
<li><strong>$item</strong> (<a class="reference internal" href="../../../../models/Item.html#Item" title="Item"><em>Item</em></a>) &#8211; </li>
<li><strong>$options</strong> (<em>array</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Omeka_File_Ingest_AbstractIngest</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_getOriginalFilename">
<tt class="descname">_getOriginalFilename</tt><big>(</big><em>array $fileInfo</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_getOriginalFilename" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the original filename of the file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$fileInfo</strong> (<em>array</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_transferFile">
<tt class="descname">_transferFile</tt><big>(</big><em>array $fileInfo</em>, <em>string $originalFilename</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_transferFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Transfer the file to Omeka.</p>
<p>To indicate validation errors, Omeka_File_Ingest_InvalidException can be thrown at any time.  To indicate other
types of non-recoverable errors related to file ingest, throw Omeka_File_Ingest_Exception.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$fileInfo</strong> (<em>array</em>) &#8211; </li>
<li><strong>$originalFilename</strong> (<em>string</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string Real path to the transferred file.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_parseFileInfo">
<tt class="descname">_parseFileInfo</tt><big>(</big><em>mixed $files</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_parseFileInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Ingest classes receive arbitrary information.  This method needs to
parse that information into an iterable array so that multiple files
can be ingested from a single identifier.</p>
<p>Example use case is Omeka_File_Ingest_Upload.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$files</strong> (<em>mixed</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::setOptions">
<tt class="descname">setOptions</tt><big>(</big><em>array $options</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::setOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Set options for ingesting files.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$options</strong> (<em>array</em>) &#8211; Available options include: - &#8216;ignore_invalid_files&#8217;: boolean false by default.  Determine whether or not to throw exceptions when a file is not valid.  This can be based on a number of factors:  whether or not the original identifier is valid (i.e. a valid URL), whether or not the file itself is valid (i.e. invalid file extension), or whether the basic algorithm for ingesting the file fails (i.e., files cannot be transferred because the files/ directory is not writeable). This option is primarily useful for skipping known invalid files when ingesting large data sets.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">void</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::ingest">
<tt class="descname">ingest</tt><big>(</big><em>mixed $fileInfo</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::ingest" title="Permalink to this definition">¶</a></dt>
<dd><p>Ingest based on arbitrary file identifier info.</p>
<p>If this is an array that has a &#8216;metadata&#8217; key, that should be an array representing element text metadata to assign
to the file.  See ActsAsElementText::addElementTextsByArray() for more details.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$fileInfo</strong> (<em>mixed</em>) &#8211; An arbitrary input (array, string, object, etc.) that corresponds to one or more files to be ingested into Omeka.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">array Ingested file records.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_ignoreIngestErrors">
<tt class="descname">_ignoreIngestErrors</tt><big>(</big><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_ignoreIngestErrors" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine whether or not to ignore file ingest errors.  Based on
&#8216;ignore_invalid_files&#8217;, which is false by default.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Returns:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_logException">
<tt class="descname">_logException</tt><big>(</big><em>Exception $e</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_logException" title="Permalink to this definition">¶</a></dt>
<dd><p>Log any exceptions that are thrown as a result of attempting to ingest
invalid files.</p>
<p>These are logged as warnings because they are being ignored by the script,
so they don&#8217;t actually kill the file ingest process.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$e</strong> (<em>Exception</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">void</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_createFile">
<tt class="descname">_createFile</tt><big>(</big><em>string $newFilePath</em>, <em>string $oldFilename</em>, <em>array $elementMetadata = Array</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_createFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a File record corresponding to an ingested file and its metadata.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$newFilePath</strong> (<em>string</em>) &#8211; Path to the file within Omeka.</li>
<li><strong>$oldFilename</strong> (<em>string</em>) &#8211; The original filename for the file.  This will usually be displayed to the end user.</li>
<li><strong>$elementMetadata</strong> (<em>array</em>) &#8211; See ActsAsElementText::addElementTextsByArray() for more information about the format of this array.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">File</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_getDestination">
<tt class="descname">_getDestination</tt><big>(</big><em>string $fromFilename</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_getDestination" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the destination path for the file to be transferred.</p>
<p>This will generate an archival filename in order to prevent naming conflicts between ingested files.</p>
<p>This should be used as necessary by Omeka_File_Ingest_AbstractIngest implementations in order to determine where to
transfer any given file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$fromFilename</strong> (<em>string</em>) &#8211; The filename from which to derive the archival filename.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::addValidator">
<tt class="descname">addValidator</tt><big>(</big><em>Zend_Validate_Interface $validator</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::addValidator" title="Permalink to this definition">¶</a></dt>
<dd><p>Add Zend Framework file validators.</p>
<p>Emulates the way Zend Framework adds validators.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$validator</strong> (<em>Zend_Validate_Interface</em>) &#8211; </li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Omeka_File_Ingest_AbstractIngest</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Omeka_File_Ingest_AbstractIngest::_validateFile">
<tt class="descname">_validateFile</tt><big>(</big><em>string $filePath</em>, <em>array $fileInfo</em><big>)</big><a class="headerlink" href="#Omeka_File_Ingest_AbstractIngest::_validateFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a file that has been transferred to Omeka.</p>
<p>Implementations of Omeka_File_Ingest_AbstractIngest should use this to validate the uploaded file based on
user-defined security criteria.</p>
<p>Important: $fileInfo may need to contain the following keys in order to work with particular Zend_Validate_File_*
validation classes:
- &#8216;name&#8217;: string filename (for Zend_Validate_File_Extension) If ZF is unable to determine the file extension when
validating, it will check the &#8216;name&#8217; attribute instead.  Current use cases involve saving the file to a temporary
location before transferring to Omeka. Most temporary files do not maintain the original file extension.
- &#8216;type&#8217;: string MIME type (for Zend_Validate_File_MimeType) If ZF is unable to determine the mime type from the
transferred file.  Unless the server running Omeka has a mime_magic file or has installed the FileInfo extension,
this will be necessary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$filePath</strong> (<em>string</em>) &#8211; Absolute path to the file.  The file should be local and readable, which is required by most (if not all) of the Zend_Validate_File_* classes.</li>
<li><strong>$fileInfo</strong> (<em>array</em>) &#8211; Set of file info that describes a given file being ingested.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean True if valid, otherwise throws an exception.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/logo-horizontal-200px.gif" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Libraries/Omeka/File/Ingest</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="AbstractSourceIngest.html"
                        title="next chapter">Omeka_File_Ingest_AbstractSourceIngest</a></p>
  <h3>This Page</h3>
  <p>See something wrong or confusing on this page?
    Please open an issue on <a href="https://github.com/omeka/OmekaDoc/issues.rst" rel="nofollow">Github</a>
    </p>
  <ul class="this-page-menu">
    
    <li><a href="https://github.com/omeka/OmekaDoc/master/sourceReference/libraries/Omeka/File/Ingest/AbstractIngest.rst"
           rel="nofollow">View Source</a>
    </li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="AbstractSourceIngest.html" title="Omeka_File_Ingest_AbstractSourceIngest"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Libraries/Omeka/File/Ingest"
             >previous</a> |</li>
    
        <li><a href="../../../../../index.html">Omeka Documentation v2.0 documentation</a> &raquo;</li>
    <p style="background-color: white; color:red;">
    This documentation is currently unstable as changes continue to be made to Omeka 2.0.    
     The final release of Omeka 2.0 may have changes.</p>    

          <li><a href="../../../../index.html" >Reference Documentation for Omeka</a> &raquo;</li>
          <li><a href="../../index.html" >Libraries/Omeka</a> &raquo;</li>
          <li><a href="../index.html" >Libraries/Omeka/File</a> &raquo;</li>
          <li><a href="index.html" >Libraries/Omeka/File/Ingest</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Roy Rosenzweig Center for History and New Media.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>